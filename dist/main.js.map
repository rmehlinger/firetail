{"version":3,"sources":["../src/main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["import {autoSub, bind, snap} from 'bobtail-rx';\nimport {ObsJsonCell, SrcJsonCell} from 'bobtail-json-cell';\n\nlet valueEvent = {value(data){\n  this._update(data.val());\n}};\nlet listEvents = {\n  child_added(data){\n    return this._updating(() => this.data[data.key] = data.val());\n  },\n  child_changed(data){\n    return this._updating(() => this.data[data.key] = data.val());\n  },\n  child_removed(data){\n    return this._updating(() => this.data[data.key]);\n  }\n};\n\nfunction identity(x) {return x;}\n\nclass FireTailBase extends ObsJsonCell {\n  constructor(refFn, xformFn=identity, init=null, events=valueEvent) {\n    // super(typeof refFn === 'function' ? refFn: () => refFn, init);\n    super(init);\n    this.refFn = refFn;\n    this.xformFn = xformFn;  // used for e.g.\n    this.events = events;\n    this.refCell = bind(this.refFn);\n    autoSub(this.refCell.onSet, ([o, n]) => {\n      if(o) {\n        o.off();  // turn off old listeners, if any\n      }\n      let entries = Object.entries(this.events);\n      this._updating(() => entries.forEach(([ev, handler]) => n.on(ev, handler.bind(this))));\n    });\n  }\n}\n\nclass DepFireTailBase extends FireTailBase {\n  constructor() {\n    super(...arguments);\n  }\n  // FIXME: figure out some way to do this via inheritance rather than copy-paste from bobtail-json-cell.\n  setProperty(getPath, basePath, obj, prop, val) {\n    if (!this._nowUpdating) {\n      throw new DepMutationError(\"Cannot mutate DepJsonCell!\");\n    }\n    else return super.setProperty(getPath, basePath, obj, prop, val);\n  }\n\n  deleteProperty(getPath, basePath, obj, prop) {\n    if (!this._nowUpdating) {\n      throw new DepMutationError(\"Cannot mutate DepJsonCell!\");\n    }\n    else return super.deleteProperty(getPath, basePath, obj, prop);\n  }\n}\n\nexport class DepFireTailCell extends DepFireTailBase {\n  constructor(refFn, init=null) {\n    super(refFn, identity, init, valueEvent);\n  }\n}\n\nexport class DepFireTailList extends DepFireTailBase {\n  constructor(refFn, init) {\n    super(refFn, init, listEvents);\n  }\n}\n\nexport class RWFireTailBase extends FireTailBase {\n  constructor(refFn, xformFn, init, events) {\n    super(init);\n    initFireTailObj.call(this, refFn, xformFn, events);\n  }\n  setProperty (getPath, basePath, obj, prop, val) {\n    // super.setProperty(getPath, basePath, obj, prop, val);\n    this.refCell.raw().update({[getPath(prop).join('/')]: val});\n  }\n  deleteProperty (getPath, basePath, obj, prop) {\n    // super.deleteProperty(getPath, basePath, obj, prop);\n    this.refCell.raw().remove(getPath(prop).join('/'));\n  }\n  push (elem) {\n    return this.refCell.raw().push(elem);\n  }\n}\n\nexport class RWFireTailCell extends RWFireTailBase {\n  constructor(refFn, init) {\n    super(refFn, identity, init, valueEvent);\n  }\n}\n\nexport class RWFireTailArray extends RWFireTailBase {\n  constructor (refFn, init, xformFn) {\n    super(refFn, xformFn, init, valueEvent);\n  }\n}"]}