!function(t,e){if("function"==typeof define&&define.amd)define("bobtail-deep-cell",["exports","bobtail-rx","bobtail-json-cell"],e);else if("undefined"!=typeof exports)e(exports,require("bobtail-rx"),require("bobtail-json-cell"));else{var r={exports:{}};e(r.exports,t.rx,t.bobtailJsonCell),t.bobtailDeepCell=r.exports}}(this,function(t,e,r){"use strict";function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function u(t){return t}Object.defineProperty(t,"__esModule",{value:!0}),t.RWFireTailArray=t.RWFireTailCell=t.RWFireTailBase=t.DepFireTailList=t.DepFireTailCell=void 0;var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),f=function t(e,r,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,r);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,r,n)}if("value"in o)return o.value;var l=o.get;if(void 0!==l)return l.call(n)},c=function(){function t(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var l,u=t[Symbol.iterator]();!(n=(l=u.next()).done)&&(r.push(l.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p={value:function(t){this._update(t.val())}},s={child_added:function(t){var e=this;return this._updating(function(){return e.data[t.key]=t.val()})},child_changed:function(t){var e=this;return this._updating(function(){return e.data[t.key]=t.val()})},child_removed:function(t){var e=this;return this._updating(function(){return e.data[t.key]})}},h=function(t){function n(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p;o(this,n);var f=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,l));return f.refFn=t,f.xformFn=r,f.events=a,f.refCell=(0,e.bind)(f.refFn),(0,e.autoSub)(f.refCell.onSet,function(t){var e=c(t,2),r=e[0],n=e[1];r&&r.off();var o=Object.entries(f.events);f._updating(function(){return o.forEach(function(t){var e=c(t,2),r=e[0],o=e[1];return n.on(r,o.bind(f))})})}),f}return l(n,r.ObsJsonCell),n}(),y=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return l(e,h),a(e,[{key:"setProperty",value:function(t,r,n,o,i){if(this._nowUpdating)return f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setProperty",this).call(this,t,r,n,o,i);throw new DepMutationError("Cannot mutate DepJsonCell!")}},{key:"deleteProperty",value:function(t,r,n,o){if(this._nowUpdating)return f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"deleteProperty",this).call(this,t,r,n,o);throw new DepMutationError("Cannot mutate DepJsonCell!")}}]),e}(),b=(t.DepFireTailCell=function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,u,r,p))}return l(e,y),e}(),t.DepFireTailList=function(t){function e(t,r){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,s))}return l(e,y),e}(),t.RWFireTailBase=function(t){function e(t,r,n,l){o(this,e);var u=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return initFireTailObj.call(u,t,r,l),u}return l(e,h),a(e,[{key:"setProperty",value:function(t,e,r,o,i){this.refCell.raw().update(n({},t(o).join("/"),i))}},{key:"deleteProperty",value:function(t,e,r,n){this.refCell.raw().remove(t(n).join("/"))}},{key:"push",value:function(t){return this.refCell.raw().push(t)}}]),e}());t.RWFireTailCell=function(t){function e(t,r){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,u,r,p))}return l(e,b),e}(),t.RWFireTailArray=function(t){function e(t,r,n){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,p))}return l(e,b),e}()});